<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, maximum-scale=1.0" />

    <title>Esther Cui's HCDE 439 Physical Computing Page!</title>

    <link href="style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <h1>Assignment 6: Talking to the web!</h1>
    <h3>February 23, 2024</h3>
    <br>
    <hr>

    <div class="a1">
      <h3>Circuit Schematic</h3>
      <figure>
        <img src="a6-schematic.jpg" />
        <figcaption>
          This is the schematic for my arduino circuit that uses a joystick, a red LED, and a 220 &#937 resistor for the LED.
        </figcaption>
        <figcaption>
          A 220 ohm resistor is used as it ensures that the current flowing through each of the red LEDs remain lower than
          a 20 mA current limit. The following calculations below showcase how much current is flowing through each LED with a 
          220 ohm resistor:
        </figcaption>
        <figcaption>
          Red LED:
          <pre>5V - 1.8V = 3.2 V</pre>
          <pre>3.2V / 220 &#937 = <u>0.0145 A or 14.5 mA</u></pre>
        </figcaption>
        <figcaption>
          There are also a variety of values being read from analogRead(), ranging from the appropriate 0 to 1023 values.
          Since we are seeing regular values being displayed in the serial monitor, we can confirm that the right amount of voltage
          (max 5V) is being drawn and joystick is producing approrpiate values that we can use to control our webpage when connected to the computer.
        </figcaption>
      </figure>
    </div>
    <br>
    <hr>

    <div class="a1">
      <h3>Circuit Image</h3>
      <figure>
        <img src="a6-circuit1.jpg" />
        <figcaption>
          This is the arduino circuit with the joystick and LED.
        </figcaption>
      </figure>
      <figure>
        <img src="a6-circuit2.jpg" />
        <figcaption>
          This the circuit including what appears on my computer screen.
        </figcaption>
      </figure>
    </div>
    <hr>

    <div class="a1-code">
      <h3>Firmware and Webpage Code</h3>
      <p>
        I utilized the following sources as references and as a basis for my code for this 
        assignment:
        <ul>
          <li><a href="https://maker.pro/arduino/tutorial/how-to-control-servo-motors-with-an-arduino-and-joystick">How to Control Servo Motors With an Arduino and Joystick</a></li>
          <li><a href="https://www.youtube.com/watch?v=rO6M5hj0V-o&ab_channel=TheCodingTrain">p5.js Web Editor: Uploading Media Files - p5.js Tutorial</a></li>
          <li><a href="https://www.youtube.com/watch?v=3UDK1GjqCq4&ab_channel=IdukundaLengo">control Led from serial monitor using arduino</a></li>
        </ul>
      </p>
      <p>
        Additionally, I also referenced the bubble example provided in the class git to understand some of the helper functions as well as how to approach some of the code I utilized.
      </p>
      <p>
        I used a png file for the heart image that is moved around the screen:
        <ul>
          <li><a href="https://www.hiclipart.com/free-transparent-background-png-clipart-zucww">Pink Pixel Heart</a></li>
          </ul>
      </p>
      <br>
      <h3>p5.js (Code)</h3>
      <pre>
        <code>
// sets a standard variable for the baud rate to be used later
const BAUD_RATE = 9600;
// delcare an empty variable that will be used for the heart image later
let heart;
// declare two variables that will be used later for the connection button
let port, connectBtn;

// The following preload() function and the code within it is referenced from
// "p5.js Web Editor: Uploading Media Files - p5.js Tutorial" to help understand
// how to properly load media files on the webpage
    // default function to allow faster loading of media and reduce loading time
function preload(){
  // the heart image file is loaded into the heart variable
  heart = loadImage('heart.png')
}

// function to set basic settings for the browser view
function setup() {
  // calls to the function below and establish and set pot communication between device and arduino
  setupSerial();
  // creates a set area within the bounds of my computer screen where the action will take place
  // the width is the width of my computer, the height is the height of my computer
  createCanvas(windowWidth, windowHeight);
}

// the following code under this function will be continuously read and played
function draw() {
  // sets the background brightness to max, appears as white on the screen
  background(255);
  // sets a constant variable that draws from the checkPort() function
  const portIsOpen = checkPort();
  // if statement for if the port is not open then the draw() function is stopped
  if (!portIsOpen) return;
  // the str variable is set based on whatever is retrieved from our port based on
  // line by line (the values generated by the joystick)
  let str = port.readUntil("\n");
  // if statement for if nothing is read from the port, then we return no values
  if (str.length == 0) return;

  // The following lines of code (from let [a0, a1] to let y_pos) is referenced from the class bubble example in order to
  // read the x(A0) and y(A1) values from the joystick
      // we establish an array for each line that is read from our port, drawing from our str variable
  let [a0, a1] = str.trim().split(",");
  // declare the x_pos variable and map it to the width that is on the computer screen
  let x_pos = map(Number(a0), 0, 1023, 0, width);
  // declare the y_pos variable and map it to the height that is on the computer screen
  let y_pos = map(Number(a1), 0, 1023, 0, height);
  
  // The image() line of code is referenced from
  // "p5.js Web Editor: Uploading Media Files - p5.js Tutorial" to understand
  // how images can be adjusted within the draw() function
      // based on our x_pos and y_pos varibales, the 70x70 pixel heart image will move to the corresponding position
  image(heart, x_pos, y_pos, 70, 70)

  // if statement that depends on the x_pos of the heart image, which will provide us with a certain
  // port value to give to the arduino
  if (x_pos > 300){
    // if the x_pos is greater than 300, then we send over 0
    port.write(0);
  }
  // else statement for if x_pos is < 300
  else{
    // if the x_pos is less than 300, then we send over 1
    port.write(1);
  }
}


// ** The following three helper functions for managing the serial connection are from
      //the p5.js examples provided in the class git

// function sets up the serial ports based on our arduino and sets up the connection
function setupSerial() {
  // sets the port variable and creates the serial connection there
  port = createSerial();

  // declare the usedPorts variable and determines if any ports have already been used
  let usedPorts = usedSerialPorts();
  // if statement for if there are any used ports
  if (usedPorts.length > 0) {
    // open and use the first port within the list, also using the approrpiate baud rate
    port.open(usedPorts[0], BAUD_RATE);
  }

  // setting up a button to tell user to "Connect to Arduino"
  connectBtn = createButton("Connect to Arduino");
  // this sets the button's position on the screen
  connectBtn.position(5, 5);
  // when the button is clicked from the mouse, the onConnectButtonClicked function is called and ran
  connectBtn.mouseClicked(onConnectButtonClicked);
}

// function to determine if the port being used is valid
function checkPort() {
  // if statement for if the port is not opened
  if (!port.opened()) {
    // the button on the screen first displays "Connect to Arduino" as a call to action
    connectBtn.html("Connect to Arduino");
    // the backgroud of the screen is gray
    background("gray");
    // this means that our arduino is not connected
    return false;
    // else statement for if we are connected to our arduino
  } else {
    // the button changes to a "Disconnect" call to action
    connectBtn.html("Disconnect");
    // this means that our arduino is successfully connected
    return true;
  }
}

// function for when our arduino is connected and we click the "Connect to Arduino" button
function onConnectButtonClicked() {
  // if statement for when the port is not open (when the button is selected)
  if (!port.opened()) {
    // the port is open and serial values can be read
    port.open(BAUD_RATE);
    // else statement for if the button is already on and port is already open
  } else {
    // the port is closed
    port.close();
  }
}  
        </code>
      </pre>
      <br>
      <h3>Arduino (Code)</h3>
      <pre>
        <code>
// declare the variable value for the LED pin number at pin 10
int led = 10;
// declare the variable value for the joystick's x-value at pin A0
int x_stick = A0;
// declare the variable value for the joystick's y-value at pin A1
int y_stick = A1;
// set up an empty variable to take the joystick's x-position value
int x_position;
// set up an empty variable to take the joystick's y-position value
int y_position;

// runs the following code once to start the rest of the code
void setup()
{
  //sets data rate in baud and starts to send in commands
  Serial.begin(9600);
  // the previously declared led variable is being used as an output for the LED
  pinMode(led, OUTPUT);
  // The following code is referenced from "How to Control Servo Motors With an Arduino and Joystick"
  // the x_stick variable (A0) is being used as an input to read values from the joystick
  pinMode(x_stick, INPUT);
  // The following code is referenced from "How to Control Servo Motors With an Arduino and Joystick"
  // the y_stick variable (A1) is being used as an input to read values from the joystick
  pinMode(y_stick, INPUT);
}

// continously run the followiing code so long as the arudino is connected to the computer,
// and a serial connection is established
void loop()
{
  // The following code is referenced from "How to Control Servo Motors With an Arduino and Joystick"
  // the x_position varibale takes on the analog value we read from A0
  x_position = analogRead(x_stick);
  // The following code is referenced from "How to Control Servo Motors With an Arduino and Joystick"
  // the y_position varibale takes on the analog value we read from A1
  y_position = analogRead(y_stick);
  // The following line of code is referenced from the bubbles class example to print out the serial value
  // print out the analog value read from A0 to give our x-coordinate
  Serial.print(x_position);
  // The following line is referenced form the class examples to structure the printed serial values
  Serial.print(",");
  // The following code is referenced from the bubbles class example to print out the serial value
  // print out the analog value read from A1 to give our y-coordinate
  Serial.println(y_position);
  // a 16 ms delay is added to ensure that the data is being smoothly and quickly read
  delay(16);

  // an intial value variable is set to be used to hold the delivered port value
  int value;
  // This following larger if/else statement is referenced from "control Led from serial monitor using arduino"
  // to allow the correct entry to be read and displayed properly on the LED
  // if statement for if there is a serial value being sent over from the computer
  if (Serial.available() > 0){
    // the value is declared to be whatever is read from the serial port
     value = Serial.read();
     // if statement for if the value is 1 (this also means that x_pos is less than 300)
     if (value == 1){
      // the LED is set to HIGH and turns on
      digitalWrite(led, HIGH);
     }
 }
 // else statement for if the value is 0 (this also means that x_pos is greater than 300)
 else{
    // the LED is set to LOW and is turned off
    digitalWrite(led, LOW);
  }
}   
        </code>
      </pre>
    </div>
    <hr>

    <div class="a1">
      <h3>Circuit Operation</h3>
      <figure>
        <img src="a6-operation.gif" />
        <figcaption>
          This clip shows the changes reflected on my web browser based on the input provided by my arduino's joystick. Based on what is occuring on the screen, the LED will turn on based on the heart's position.
        </figcaption>
      </figure>
    </div>
  </body>
</html>
